<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>MrCoin Master</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <!-- Telegram WebApp Script (‡¶è‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶¨ ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø) -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶∞ CSS ‡¶ï‡ßã‡¶° ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
    body {
      background: #0d0d1a;
      color: #ffffff;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #FFD700;
      margin-bottom: 10px;
    }
    #profile, #wallet, #task, #withdraw {
      background: #14142b;
      padding: 15px;
      margin: 15px auto;
      border-radius: 12px;
      max-width: 500px;
      box-shadow: 0 0 15px #FFD70033;
    }
    input, select, button {
      padding: 10px;
      margin: 8px 0;
      width: 90%;
      border-radius: 8px;
      font-size: 16px;
      border: none;
    }
    input, select {
      background: #1a1a2e;
      color: #FFD700;
      border: 1px solid #FFD70066;
    }
    button {
      background: #FFD700;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: #ffcc00;
    }
    #mrcoin {
      width: 24px;
      vertical-align: middle;
      margin-right: 5px;
    }
    iframe#ad {
      width: 100%;
      height: 90px;
      border: none;
      margin: 20px 0;
      border-radius: 8px;
      background: #fff;
    }
  </style>
</head>
<body>

  <h1>ü™ô MrCoin Master</h1>

  <div id="game-container">
    <div id="profile">
      <!-- ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá -->
      <p>üë§ Player: <b id="username">Loading...</b></p>
      <p>üìà Level: <b id="level">1</b> | ‚≠ê XP: <b id="xp">0</b></p>
    </div>

    <div id="wallet">
      <p>üéØ Points: <b id="points">0</b></p>
      <p><img id="mrcoin" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Gold_coin_icon.png/128px-Gold_coin_icon.png"/> MrCoins: <b id="coins">0</b></p>
    </div>

    <div id="task">
      <h3>üß† Task</h3>
      <p id="task-text">Loading task...</p>
      <input type="text" id="answer" placeholder="Your answer" />
      <br/>
      <button onclick="submitAnswer()">Submit Answer</button>
    </div>

    <iframe id="ad" srcdoc="
      <script async='async' data-cfasync='false' src='//pl27105920.profitableratecpm.com/9db5b9b75728e725b0490f241552e303/invoke.js'></script>
      <div id='container-9db5b9b75728e725b0490f241552e303'></div>
    "></iframe>

    <div id="withdraw">
      <h3>üí∏ Withdraw MrCoins</h3>
      <input type="text" id="name" placeholder="Your Name" />
      <input type="number" id="amount" placeholder="MrCoins to Withdraw (min 10)" />
      <select id="method">
        <option value="bKash">bKash</option>
        <option value="Nagad">Nagad</option>
      </select>
      <input type="text" id="number" placeholder="Your Payment Number" />
      <button onclick="submitWithdraw()">Request Withdraw</button>
      <div id="message"></div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá
      apiKey: "AIzaSyBdUOmQQlRfpNkHpDdMpiAOrsAehqKEdt4",
      authDomain: "mr-coin-mastar.firebaseapp.com",
      projectId: "mr-coin-mastar",
      storageBucket: "mr-coin-mastar.firebasestorage.app",
      messagingSenderId: "275029670605",
      appId: "1:275029670605:android:e42bb40e9b26314367c784"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶®‡ßç‡¶ü‡¶ø‡¶ó‡ßç‡¶∞‡ßá‡¶∂‡¶® ---
    const tg = window.Telegram.WebApp;
    tg.ready(); // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶ï‡ßá ‡¶ú‡¶æ‡¶®‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶Ø‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶∞‡ßá‡¶°‡¶ø

    // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
    const tgUser = tg.initDataUnsafe?.user;
    // ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶á‡¶â‡¶®‡¶ø‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá, ‡¶è‡¶ü‡¶ø ‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶
    const userId = tgUser ? String(tgUser.id) : "guest_user"; 
    
    // UI-‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá
    document.getElementById("username").textContent = tgUser?.first_name || "Guest";

    // ‡¶ó‡ßá‡¶Æ‡ßá‡¶∞ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤
    let level = 1, xp = 0, points = 0, coins = 0;

    const tasks = [
      { text: "What is 2 + 2?", answer: "4" },
      { text: "Type 'hello'", answer: "hello" },
      ...Array.from({ length: 500 }, (_, i) => ({
        text: `Task #${i+6}: Type '${i+6}'`, answer: `${i+6}`
      }))
    ];
    
    // --- ‡¶ó‡ßá‡¶Æ‡ßá‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á) ---
    function updateUI() {
      document.getElementById("level").textContent = level;
      document.getElementById("xp").textContent = xp;
      document.getElementById("points").textContent = points;
      document.getElementById("coins").textContent = coins;
    }

    function loadTask() {
      const task = tasks[level - 1] || { text: "üéâ All tasks complete!", answer: "" };
      document.getElementById("task-text").textContent = task.text;
      document.getElementById("answer").value = "";
    }

    function saveToFirebase() {
      // ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
      db.ref("players_tg/" + userId).set({
        level, xp, points, coins,
        username: tgUser?.username || "N/A",
        firstName: tgUser?.first_name || "Guest"
      });
    }

    function loadFromFirebase() {
      db.ref("players_tg/" + userId).once("value").then(snapshot => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          level = data.level || 1;
          xp = data.xp || 0;
          points = data.points || 0;
          coins = data.coins || 0;
        } else {
            // ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶π‡¶≤‡ßá ‡¶§‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡ßá‡¶ü‡¶æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            saveToFirebase();
        }
        updateUI();
        loadTask();
      });
    }

    function submitAnswer() {
      const input = document.getElementById("answer").value.trim();
      const task = tasks[level - 1];
      if (!task) return;

      if (task.answer === "" || input.toLowerCase() === task.answer.toLowerCase()) {
        level++; xp += 5; points += 5;
        if (points >= 1000) {
          coins += Math.floor(points / 1000);
          points %= 1000;
        }
        updateUI();
        saveToFirebase();
        loadTask();
        tg.HapticFeedback.notificationOccurred('success'); // ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá ‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶®
      } else {
        alert("‚ùå Wrong answer. Try again.");
        tg.HapticFeedback.notificationOccurred('error'); // ‡¶≠‡ßÅ‡¶≤ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá ‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶®
      }
    }

    function submitWithdraw() {
        // ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ‡¶•‡¶æ‡¶ï‡¶¨‡ßá, ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶¨
        // ...
    }

    // --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Æ‡ßÇ‡¶≤ ‡¶Ö‡¶Ç‡¶∂ ---
    if (!tgUser) {
        // ‡¶Ø‡¶¶‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶π‡ßü
        document.body.innerHTML = "<h1>‡¶è‡¶á ‡¶ó‡ßá‡¶Æ‡¶ü‡¶ø ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá‡¶á ‡¶ñ‡ßá‡¶≤‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</h1>";
    } else {
        // ‡¶Ø‡¶¶‡¶ø ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶π‡ßü, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá
        loadFromFirebase();
    }
  </script>
</body>
</html>