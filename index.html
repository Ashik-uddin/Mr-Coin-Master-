<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>MrCoin Master</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg-color: #0f0c29;
      --primary-color: rgba(255, 255, 255, 0.05);
      --border-color: rgba(255, 255, 255, 0.1);
      --accent-color: #f7b733;
      --text-color: #ffffff;
      --hint-color: #aaaaaa;
      font-family: 'Poppins', sans-serif;
    }
    body { background: linear-gradient(to right, #0f0c29, #302b63, #24243e); color: var(--text-color); margin: 0; padding: 15px 15px 90px 15px; }
    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .card { background: var(--primary-color); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 20px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border-color); }
    .header { text-align: center; margin-bottom: 20px; }
    .header .balance { font-size: 32px; font-weight: 700; background: -webkit-linear-gradient(45deg, var(--accent-color), #fc4a1a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .level-progress { background: var(--primary-color); border-radius: 10px; padding: 5px; margin-top: 10px; }
    .progress-bar { background: linear-gradient(to right, #fc4a1a, var(--accent-color)); height: 10px; width: 0%; border-radius: 10px; transition: width 0.5s ease-in-out; }
    .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: center; }
    .stat-grid i { color: var(--accent-color); margin-right: 5px; }
    .task-list .task-item { display: flex; align-items: center; padding: 15px; margin-bottom: 10px; background: var(--primary-color); border: 1px solid var(--border-color); border-radius: 15px; }
    .task-list .task-item .claim-btn { margin-left: auto; background: var(--accent-color); color: #000; border: none; padding: 8px 15px; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .task-list .task-item.completed { opacity: 0.5; }
    .task-list .task-item.completed .claim-btn { background: #555; cursor: not-allowed; }
    .bottom-nav { position: fixed; bottom: 10px; left: 10px; right: 10px; background: rgba(0,0,0,0.3); backdrop-filter: blur(15px); display: flex; justify-content: space-around; padding: 10px 0; border-radius: 20px; border: 1px solid var(--border-color); }
    .nav-btn { background: none; border: none; color: var(--hint-color); font-size: 12px; text-align: center; cursor: pointer; }
    .nav-btn i { font-size: 22px; display: block; margin-bottom: 4px; }
    .nav-btn.active { color: var(--accent-color); }
    .action-button { background: var(--accent-color); color: #000; border: none; padding: 12px; width: 100%; border-radius: 12px; font-weight: 600; font-size: 16px; }
    
    /* Game Hub Styles */
    .game-hub .game-option { text-align: center; cursor: pointer; padding: 20px; border-radius: 15px; background: var(--primary-color); border: 1px solid var(--border-color); }
    .game-hub i { font-size: 40px; margin-bottom: 10px; }
    .game-hub p { margin: 0; font-weight: 600; }
    
    /* Tap Tap Game Styles */
    #tap-game-area { text-align: center; display: none; }
    #tap-button { background: linear-gradient(45deg, #ff512f, #f09819); color: white; border: none; width: 150px; height: 150px; border-radius: 50%; font-size: 24px; font-weight: 700; box-shadow: 0 0 20px #ff512f; }
    #tap-button:active { transform: scale(0.95); }
    .game-info { display: flex; justify-content: space-around; margin: 20px 0; }
  </style>
</head>
<body>

  <!-- Pages -->
  <div id="home-page" class="page active">
    <!-- Home page content from previous code -->
  </div>

  <div id="tasks-page" class="page">
    <!-- Tasks page content from previous code -->
  </div>

  <div id="game-page" class="page">
      <div class="stat-card" style="margin-bottom: 20px; text-align:center;"><span><i class="fas fa-bolt"></i> Your Energy</span><b id="energy-count">10</b></div>
      
      <!-- Game Hub Selection -->
      <div id="game-hub" class="card game-hub">
          <div class="stat-grid">
              <div class="game-option" onclick="showGame('crystal-cave')">
                  <i class="fas fa-gem" style="color: #8a2be2;"></i>
                  <p>Crystal Cave</p>
              </div>
              <div class="game-option" onclick="showGame('tap-tap')">
                  <i class="fas fa-hand-pointer" style="color: #f09819;"></i>
                  <p>Tap Tap Mania</p>
              </div>
          </div>
      </div>

      <!-- Crystal Cave Game Area (Initially Hidden) -->
      <div id="crystal-cave-game" class="card" style="display:none; text-align:center;">
          <div class="card-header">ðŸ’Ž Crystal Cave Adventure</div>
          <button onclick="exploreCave()" class="action-button" style="background: linear-gradient(45deg, #8a2be2, #4b0082);">Explore (1 Energy)</button>
          <div id="cave-result" style="margin-top: 20px; font-weight: 500; min-height: 24px;"></div>
      </div>
      
      <!-- Tap Tap Game Area (Initially Hidden) -->
      <div id="tap-tap-game" class="card" style="display:none;">
          <div class="card-header" style="text-align:center;">ðŸ’¥ Tap Tap Mania</div>
          <div id="tap-game-start">
              <button onclick="startTapGame()" class="action-button" style="background: linear-gradient(45deg, #ff512f, #f09819);">Start Game (1 Energy)</button>
          </div>
          <div id="tap-game-area" style="display:none;">
              <div class="game-info">
                  <div>Time: <b id="time-left">10</b>s</div>
                  <div>Taps: <b id="tap-count">0</b></div>
              </div>
              <button id="tap-button" onclick="handleTap()">Tap!</button>
          </div>
          <div id="tap-result" style="margin-top: 20px; font-weight: 500; min-height: 24px; text-align:center;"></div>
      </div>
  </div>
  
  <div id="wallet-page" class="page">
    <!-- Wallet page content from previous code -->
  </div>

  <div class="bottom-nav">
    <!-- Bottom nav content from previous code -->
  </div>
  
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script type='text/javascript' src='//pl27116575.profitableratecpm.com/fe/bf/32/febf3256881a0941fe9a6905755fc859.js'></script>
  
  <script>
    // --- Start of JavaScript ---
    const firebaseConfig = { /* à¦†à¦ªà¦¨à¦¾à¦° Firebase Config */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const tg = window.Telegram.WebApp;

    let playerData = { /* ... */ };
    let userId = null;
    let tapGameInterval = null;

    function showGame(gameName) {
        document.getElementById('game-hub').style.display = 'none';
        if (gameName === 'crystal-cave') {
            document.getElementById('crystal-cave-game').style.display = 'block';
        } else if (gameName === 'tap-tap') {
            document.getElementById('tap-tap-game').style.display = 'block';
            document.getElementById('tap-game-start').style.display = 'block';
            document.getElementById('tap-game-area').style.display = 'none';
            document.getElementById('tap-result').textContent = '';
        }
    }

    function startTapGame() {
        if (playerData.energy <= 0) { alert("Not enough energy!"); return; }
        playerData.energy--;
        updateUI();
        saveData();

        document.getElementById('tap-game-start').style.display = 'none';
        document.getElementById('tap-game-area').style.display = 'block';
        document.getElementById('tap-result').textContent = '';
        
        let timeLeft = 10;
        let taps = 0;
        
        document.getElementById('time-left').textContent = timeLeft;
        document.getElementById('tap-count').textContent = taps;

        window.handleTap = () => {
            taps++;
            document.getElementById('tap-count').textContent = taps;
        };

        tapGameInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('time-left').textContent = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(tapGameInterval);
                endTapGame(taps);
            }
        }, 1000);
    }

    function endTapGame(taps) {
        document.getElementById('tap-game-area').style.display = 'none';
        document.getElementById('tap-game-start').style.display = 'block';

        const pointsEarned = Math.floor(taps * 0.5); // Example: 0.5 points per tap
        const xpEarned = Math.floor(taps * 0.2); // Example: 0.2 XP per tap

        playerData.points += pointsEarned;
        playerData.xp += xpEarned;

        document.getElementById('tap-result').textContent = `ðŸŽ‰ You tapped ${taps} times and earned ${pointsEarned} points!`;
        
        // Check for level up
        const xpTarget = 100 * playerData.level;
        if (playerData.xp >= xpTarget) {
            playerData.level++;
            playerData.xp -= xpTarget;
            alert(`Congratulations! You've reached Level ${playerData.level}!`);
        }

        updateUI();
        saveData();
    }
    
    // --- Rest of your JavaScript code ---
    // (initializeApp, loadFromFirebase, saveData, etc. from previous response)
    // IMPORTANT: Make sure to copy the full JS code from the previous working version here.
    // The snippet above only shows the NEW game logic.
  </script>
</body>
</html>
