<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ¬ MovieVerse v4.0: Custom Search</title>
    <!-- Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #12101a, #2c2541);
            --primary-color: #00e5ff;
            --secondary-color: #ff00e6;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --text-color: #f0f0f0;
            --text-muted-color: #a0a0a0;
        }

        body {
            background: var(--bg-gradient);
            color: var(--text-color);
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
        }

        .main-container {
            max-width: 1200px;
            margin: 1rem auto;
            padding: 1rem;
        }

        .glass-card {
            background: var(--glass-bg);
            border: var(--glass-border);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.25);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.3);
        }

        .neon-btn {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
            padding: 10px 20px;
        }

        .neon-btn:hover, .neon-btn:focus {
            background: var(--primary-color);
            color: #111;
            box-shadow: 0 0 20px var(--primary-color);
        }
        
        .neon-btn.secondary { border-color: var(--secondary-color); color: var(--secondary-color); }
        .neon-btn.secondary:hover { background: var(--secondary-color); box-shadow: 0 0 20px var(--secondary-color); }

        .form-control, .form-select {
            background-color: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.2); color: white;
        }
        .form-control:focus, .form-select:focus {
            background-color: rgba(0, 0, 0, 0.3); color: white; border-color: var(--primary-color); box-shadow: 0 0 8px var(--primary-color);
        }
        
        .nav-tabs { border-bottom: 1px solid rgba(255,255,255,0.2); justify-content: center; }
        .nav-tabs .nav-link { background: transparent; border: none; color: var(--text-muted-color); font-weight: 600; margin: 0 10px; }
        .nav-tabs .nav-link.active { color: var(--primary-color); background-color: transparent; border-bottom: 3px solid var(--primary-color); }
        
        .tab-pane { display: none; }
        .tab-pane.active { display: block; animation: fadeIn 0.5s ease; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { to { opacity: 0; } }

        .points-display, .pps-display { font-size: 1.5rem; color: var(--primary-color); font-weight: 700; }
        .pps-display { color: var(--secondary-color); font-size: 1.2rem; }

        .game-generator-card {
            background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px; margin-bottom: 15px;
            display: flex; flex-direction: column; gap: 10px;
        }
        
        .progress { background-color: rgba(255, 255, 255, 0.1); height: 5px; }
        .progress-bar { background-color: var(--secondary-color); }
        
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast-notification {
            background: #282a36; color: white; padding: 15px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); margin-bottom: 10px;
            border-left: 5px solid var(--primary-color); animation: slideIn 0.5s ease;
        }
        .toast-notification.error { border-left-color: #ff5555; }
        .toast-notification.success { border-left-color: #50fa7b; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        
        .achievement.unlocked { color: var(--primary-color); }
        .achievement.unlocked .fa-trophy { text-shadow: 0 0 10px var(--primary-color); }
        .footer-link { cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>
<!-- Toast Container -->
<div id="toast-container"></div>

<div class="main-container">
    <!-- Persistent Header -->
    <header class="glass-card d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="fw-bold m-0" style="color: var(--text-color);">ðŸŽ¬ MovieVerse</h1>
            <small class="text-muted">v4.0 Custom Search</small>
        </div>
        <div class="text-end">
            <h4 class="m-0 points-display"><i class="fas fa-coins"></i> <span id="headerPointsDisplay">0</span></h4>
            <small class="pps-display fw-bold"><i class="fas fa-chart-line"></i> <span id="headerPPSDisplay">0</span> PPS</small>
        </div>
    </header>

    <!-- Navigation -->
    <ul class="nav nav-tabs mb-4" id="main-tabs">
        <li class="nav-item"><a class="nav-link active" data-tab="search-view" href="#"><i class="fas fa-search me-2"></i>Movie Search</a></li>
        <li class="nav-item"><a class="nav-link" data-tab="game-view" href="#"><i class="fas fa-gamepad me-2"></i>Point Game</a></li>
        <li class="nav-item" id="admin-nav-tab" style="display: none;"><a class="nav-link" data-tab="admin-panel" href="#"><i class="fas fa-user-shield me-2"></i>Admin</a></li>
    </ul>

    <!-- Main Content Area -->
    <main>
        <!-- Search View -->
        <div id="search-view" class="tab-pane active">
            <div class="row">
                <div class="col-lg-8">
                     <div class="glass-card"><div class="input-group"><input type="text" id="searchInput" class="form-control form-control-lg" placeholder="Enter movie name..."><button class="neon-btn" onclick="app.core.search()"><i class="fas fa-search"></i></button></div></div>
                    <div id="results" class="row"></div>
                </div>
                <div class="col-lg-4">
                    <div class="glass-card">
                        <h5 class="mb-3 text-center"><i class="fas fa-hand-holding-usd me-2"></i>Request Payout</h5>
                        <div class="input-group"><select id="payoutMethod" class="form-select" onchange="app.ui.updatePlaceholder()"><option value="Binance">Binance</option><option value="TG Wallet">Telegram Wallet</option></select><input type="text" id="payoutInfo" class="form-control"></div>
                        <button class="neon-btn w-100 mt-3" onclick="app.core.requestPayout()">Withdraw</button>
                        <small class="d-block mt-2 text-muted text-center">Min. 24,000 points</small>
                    </div>
                    <div class="glass-card">
                        <p class="text-center m-0">Not an admin? <span class="footer-link" data-bs-toggle="modal" data-bs-target="#adminLoginModal">Admin Login</span></p>
                    </div>
                </div>
            </div>
             <div id="countdown" class="text-center mt-4"></div>
        </div>

        <!-- Game View -->
        <div id="game-view" class="tab-pane">
            <div class="row">
                <div class="col-lg-8">
                    <div class="glass-card"><h2><i class="fas fa-rocket me-2"></i>Point Generators</h2><div id="generators-list" class="row"></div></div>
                </div>
                <div class="col-lg-4">
                    <div class="glass-card"><h2><i class="fas fa-trophy me-2"></i>Achievements</h2><div id="achievements-list"></div></div>
                </div>
            </div>
        </div>
        
        <!-- Admin View (Integrated) -->
        <div id="admin-panel" class="tab-pane">
             <div class="glass-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="m-0">ðŸ”‘ Admin Panel</h1>
                    <button class="btn btn-outline-danger" onclick="app.admin.logout()">Logout</button>
                </div>
                <h4 class="mb-3">Payout Requests</h4>
                <div id="payout-requests-list" class="table-responsive"></div>
            </div>
        </div>
    </main>
</div>

<!-- Admin Login Modal -->
<div class="modal fade" id="adminLoginModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered"><div class="modal-content" style="background: #1d1a27; border: var(--glass-border);"><div class="modal-header border-0"><h5 class="modal-title">Admin Login</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="mb-3"><label for="adminUser" class="form-label">Username</label><input type="text" class="form-control" id="adminUser"></div><div class="mb-3"><label for="adminPass" class="form-label">Password</label><input type="password" class="form-control" id="adminPass"></div></div><div class="modal-footer border-0"><button type="button" class="neon-btn" onclick="app.admin.login()"><i class="fas fa-sign-in-alt me-2"></i>Login</button></div></div></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ===================================================================================
//  APP STRUCTURE v4.0 (Stable & Complete)
// ===================================================================================
const app = {
    config: {
        // API Key for Google Custom Search. Might need to be different from YouTube API Key.
        API_KEY: 'AIzaSyD4cw5u_vi9uBX8xUEsu03Pgf7_oDEXs0MZ',
        // Google Programmable Search Engine ID
        CSE_ID: '7604e1aeabfdf4120',
        ADMIN_USER: 'ashikbro',
        ADMIN_PASS: '1qa2wsz3',
        POINTS_PER_REWARDED_AD: 50,
        POINTS_PER_DOWNLOAD_AD: 30,
        POINTS_PER_INTERVAL_AD: 100,
        WITHDRAWAL_THRESHOLD: 24000,
        AD_LOAD_TIMEOUT: 12000,
        GAME_TICK_INTERVAL: 100,
        SAVE_INTERVAL: 5000,
    },
    state: {
        userPoints: 0,
        adInterval: null,
        game: {
            totalPPS: 0,
            generators: [
                { id: 'g1', name: 'Auto Clicker', icon: 'fa-mouse-pointer', level: 0, baseCost: 50, ppsPerLevel: 0.5 },
                { id: 'g2', name: 'Script Bot', icon: 'fa-robot', level: 0, baseCost: 500, ppsPerLevel: 4 },
                { id: 'g3', name: 'Server Farm', icon: 'fa-server', level: 0, baseCost: 4000, ppsPerLevel: 25 },
                { id: 'g4', name: 'AI Network', icon: 'fa-brain', level: 0, baseCost: 25000, ppsPerLevel: 120 },
            ],
            achievements: [
                { id: 'ac1', name: 'First Step', desc: 'Upgrade a Generator for the first time', reward: 100, unlocked: false, condition: () => app.state.game.generators.some(g => g.level > 0) },
                { id: 'ac2', name: 'Getting Serious', desc: 'Reach 100 Points Per Second (PPS)', reward: 1000, unlocked: false, condition: () => app.state.game.totalPPS >= 100 },
                { id: 'ac3', name: 'Big Spender', desc: 'Spend 50,000 points on upgrades', reward: 5000, unlocked: false, condition: () => (app.data.load().pointsSpentOnGame || 0) >= 50000 },
                { id: 'ac4', name: 'Millionaire', desc: 'Possess 1,000,000 points at once', reward: 10000, unlocked: false, condition: () => app.state.userPoints >= 1000000 },
            ],
            pointsSpentOnGame: 0
        }
    },

    init() {
        document.addEventListener('DOMContentLoaded', () => {
            this.data.load();
            this.ui.setupEventListeners();
            this.ui.updateAllDisplays();
            this.game.init();
            if (sessionStorage.getItem('isAdminLoggedIn') === 'true') {
                this.admin.showPanel();
            }
            setInterval(() => this.data.save(), this.config.SAVE_INTERVAL);
        });
    },
    
    ui: {
        showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            const iconClass = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
            toast.innerHTML = `<i class="fas ${iconClass} me-2"></i> ${message}`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.animation = 'fadeOut 0.5s ease forwards'; setTimeout(() => toast.remove(), 500); }, 4000);
        },
        setupEventListeners() {
            document.querySelectorAll('#main-tabs .nav-link').forEach(tab => {
                tab.addEventListener('click', (e) => { e.preventDefault(); this.showTab(e.target.getAttribute('data-tab')); });
            });
        },
        showTab(tabId) {
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('#main-tabs .nav-link').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
        },
        updateAllDisplays() {
            this.updatePointsDisplay();
            this.game.renderGenerators();
            this.game.renderAchievements();
            this.game.calculateTotalPPS();
        },
        updatePointsDisplay() {
            const points = Math.floor(app.state.userPoints);
            document.getElementById('headerPointsDisplay').innerText = points.toLocaleString();
            document.getElementById('headerPPSDisplay').innerText = app.state.game.totalPPS.toFixed(1).toLocaleString();
        },
        updatePlaceholder() {
            const methodEl = document.getElementById('payoutMethod');
            const infoInputEl = document.getElementById('payoutInfo');
            if(!methodEl || !infoInputEl) return;
            if (methodEl.value === 'Binance') infoInputEl.placeholder = 'Your Binance Pay ID';
            else if (methodEl.value === 'TG Wallet') infoInputEl.placeholder = 'Your Telegram @Username';
        },
        disableActions(videoId) {
            const btns = document.querySelectorAll(`#card-${videoId} button`);
            if (btns.length === 0) return false;
            btns.forEach(btn => btn.disabled = true);
            return true;
        },
        enableActions(videoId) {
            const btns = document.querySelectorAll(`#card-${videoId} button`);
            btns.forEach(btn => btn.disabled = false);
        }
    },

    core: {
        async search() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return app.ui.showToast('Please enter a movie name.', 'error');
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="text-center p-5"><i class="fas fa-spinner fa-spin fa-3x"></i></div>';
            
            try {
                const url = `https://www.googleapis.com/customsearch/v1?key=${app.config.API_KEY}&cx=${app.config.CSE_ID}&q=${encodeURIComponent(query)} full movie`;
                const res = await fetch(url);
                const data = await res.json();

                if (data.error) throw new Error(data.error.message || 'Unknown API Error');
                
                // Filter for YouTube links only
                const youtubeItems = data.items ? data.items.filter(item => item.link && item.link.includes('youtube.com/watch')) : [];

                resultsDiv.innerHTML = '';
                if (youtubeItems.length === 0) {
                    resultsDiv.innerHTML = '<p class="text-center p-4">ðŸ˜¢ No YouTube movies found for this search. Try a different name.</p>';
                    return;
                }

                youtubeItems.slice(0, 4).forEach(item => { // Show max 4 results
                    try {
                        const videoUrl = new URL(item.link);
                        const videoId = videoUrl.searchParams.get('v');
                        if (!videoId) return; // Skip if no video ID found

                        resultsDiv.innerHTML += `
                            <div class="col-md-6" id="card-${videoId}">
                                <div class="glass-card">
                                    <div class="ratio ratio-16x9 mb-3"><iframe class="rounded" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe></div>
                                    <h6 class="mt-2 text-truncate" title="${item.title}">${item.title}</h6>
                                    <div class="d-flex gap-2 mt-2">
                                        <button class="neon-btn btn-sm flex-grow-1" onclick="app.core.triggerRewardedInterstitial('${videoId}')"><i class="fas fa-eye me-1"></i> Watch (+${app.config.POINTS_PER_REWARDED_AD})</button>
                                        <button class="neon-btn secondary btn-sm flex-grow-1" onclick="app.core.showAdThenDownload('${videoId}')"><i class="fas fa-download me-1"></i> DL (+${app.config.POINTS_PER_DOWNLOAD_AD})</button>
                                    </div>
                                    <div class="loader text-center mt-2" style="display:none; color:var(--primary-color);"><small>Loading Ad...</small></div>
                                </div>
                            </div>`;
                    } catch (e) {
                        console.error("Error processing item link: ", item.link, e);
                    }
                });

            } catch (error) {
                console.error("API Search Error:", error);
                resultsDiv.innerHTML = `<div class="text-center text-danger p-4"><strong>API Error:</strong> ${error.message}<br><small>The API key may be invalid for Custom Search or has reached its quota.</small></div>`;
                app.ui.showToast(`Search failed: ${error.message}`, 'error');
            }
        },
        showAdWithTimeout() {
            return new Promise((resolve, reject) => {
                if (typeof show_s === 'undefined') return reject(new Error('Ad library not loaded.'));
                const timeoutId = setTimeout(() => reject(new Error('Ad timed out')), app.config.AD_LOAD_TIMEOUT);
                show_s().then(res => { clearTimeout(timeoutId); resolve(res); }).catch(err => { clearTimeout(timeoutId); reject(err); });
            });
        },
        showAdThenDownload(videoId) {
            if (!app.ui.disableActions(videoId)) return;
            document.querySelector(`#card-${videoId} .loader`).style.display = 'block';
            this.showAdWithTimeout().then(() => {
                app.data.updatePoints(app.config.POINTS_PER_DOWNLOAD_AD);
                app.ui.showToast(`+${app.config.POINTS_PER_DOWNLOAD_AD} points earned!`, 'success');
            }).catch(e => {
                console.error('Download Ad Error:', e.message);
                app.ui.showToast('Ad failed, download starting.', 'error');
            }).finally(() => {
                app.ui.enableActions(videoId);
                document.querySelector(`#card-${videoId} .loader`).style.display = 'none';
                window.open(`https://www.y2mate.com/youtube/${videoId}`, '_blank');
            });
        },
        triggerRewardedInterstitial(videoId) {
            if (!app.ui.disableActions(videoId)) return;
            document.querySelector(`#card-${videoId} .loader`).style.display = 'block';
            this.showAdWithTimeout().then(() => {
                app.data.updatePoints(app.config.POINTS_PER_REWARDED_AD);
                app.ui.showToast(`Ad watched! You earned ${app.config.POINTS_PER_REWARDED_AD} points.`, 'success');
            }).catch(e => {
                console.error('Rewarded Ad Error:', e.message);
                app.ui.showToast('Ad could not be loaded. Please try again.', 'error');
            }).finally(() => {
                app.ui.enableActions(videoId);
                document.querySelector(`#card-${videoId} .loader`).style.display = 'none';
            });
        },
        requestPayout() {
            const method = document.getElementById('payoutMethod').value;
            const details = document.getElementById('payoutInfo').value.trim();
            if (!details) return app.ui.showToast('Please enter your payout details.', 'error');
            if (app.state.userPoints < app.config.WITHDRAWAL_THRESHOLD) return app.ui.showToast(`You need at least ${app.config.WITHDRAWAL_THRESHOLD} points.`, 'error');
            const usdAmount = Math.floor(app.state.userPoints / 24000);
            const pointsToDeduct = usdAmount * 24000;
            if (confirm(`Withdraw ${pointsToDeduct} points for $${usdAmount} to '${method}: ${details}'?`)) {
                app.data.savePayoutRequest(method, details, pointsToDeduct, usdAmount);
                app.data.updatePoints(-pointsToDeduct);
                app.ui.showToast('Withdrawal request submitted!', 'success');
                document.getElementById('payoutInfo').value = '';
            }
        }
    },
    
    game: {
        init() {
            setInterval(this.gameLoop.bind(this), app.config.GAME_TICK_INTERVAL);
        },
        gameLoop() {
            if (app.state.game.totalPPS > 0) {
                const pointsThisTick = app.state.game.totalPPS * (app.config.GAME_TICK_INTERVAL / 1000);
                app.state.userPoints += pointsThisTick;
                app.ui.updatePointsDisplay();
                this.updateProgressBars();
            }
        },
        calculateCost(generator) {
            return Math.floor(generator.baseCost * Math.pow(1.25, generator.level));
        },
        calculateTotalPPS() {
            app.state.game.totalPPS = app.state.game.generators.reduce((total, gen) => total + (gen.level * gen.ppsPerLevel), 0);
            app.ui.updatePointsDisplay();
        },
        buyGenerator(genId) {
            const gen = app.state.game.generators.find(g => g.id === genId);
            const cost = this.calculateCost(gen);
            if (app.state.userPoints >= cost) {
                app.data.updatePoints(-cost, true, cost);
                gen.level++;
                this.calculateTotalPPS();
                this.renderGenerators();
                this.checkAchievements();
            } else {
                app.ui.showToast("Not enough points!", "error");
            }
        },
        renderGenerators() {
            const container = document.getElementById('generators-list');
            if(!container) return;
            container.innerHTML = '';
            app.state.game.generators.forEach(gen => {
                const cost = this.calculateCost(gen);
                const pps = gen.level * gen.ppsPerLevel;
                container.innerHTML += `
                    <div class="col-md-6">
                        <div class="game-generator-card">
                            <div class="d-flex justify-content-between">
                                <h5 class="m-0"><i class="fas ${gen.icon} me-2 text-primary"></i>${gen.name}</h5>
                                <span>Lvl. ${gen.level}</span>
                            </div>
                            <small class="text-muted">Producing: ${pps.toFixed(1)} PPS</small>
                            <div class="progress mt-1"><div class="progress-bar" id="prog-${gen.id}" role="progressbar" style="width: 0%;"></div></div>
                            <button class="neon-btn secondary btn-sm mt-2" onclick="app.game.buyGenerator('${gen.id}')" ${app.state.userPoints < cost ? 'disabled' : ''}>
                                Upgrade for ${cost.toLocaleString()}
                            </button>
                        </div>
                    </div>`;
            });
        },
        updateProgressBars() {
            app.state.game.generators.forEach(gen => {
                const cost = this.calculateCost(gen);
                const progress = Math.min((app.state.userPoints / cost) * 100, 100);
                const bar = document.getElementById(`prog-${gen.id}`);
                if(bar) bar.style.width = `${progress}%`;
            });
        },
        checkAchievements() {
            app.state.game.achievements.forEach(ach => {
                if (!ach.unlocked && ach.condition()) {
                    ach.unlocked = true;
                    app.data.updatePoints(ach.reward);
                    app.ui.showToast(`Achievement: ${ach.name}! (+${ach.reward} Pts)`, 'success');
                    this.renderAchievements();
                }
            });
        },
        renderAchievements() {
            const container = document.getElementById('achievements-list');
            if(!container) return;
            container.innerHTML = '';
            app.state.game.achievements.forEach(ach => {
                container.innerHTML += `<div class="achievement ${ach.unlocked ? 'unlocked' : 'text-muted'} mb-2"><i class="fas fa-trophy me-2"></i><strong>${ach.name}</strong><small class="d-block">${ach.desc}</small></div>`;
            });
        }
    },
    
    data: {
        updatePoints(amount, save = true, spentAmount = 0) {
            app.state.userPoints += amount;
            if (spentAmount > 0) app.state.game.pointsSpentOnGame += spentAmount;
            if (save) this.save();
        },
        savePayoutRequest(method, details, points, amount) {
            const requests = this.loadPayoutRequests();
            requests.push({ method, details, points, amount, date: new Date().toLocaleString() });
            localStorage.setItem('payoutRequests', JSON.stringify(requests));
        },
        loadPayoutRequests() { return JSON.parse(localStorage.getItem('payoutRequests')) || []; },
        save() {
            const dataToSave = {
                userPoints: app.state.userPoints,
                game: {
                    generators: app.state.game.generators.map(g => ({ id: g.id, level: g.level })),
                    achievements: app.state.game.achievements.map(a => ({ id: a.id, unlocked: a.unlocked })),
                    pointsSpentOnGame: app.state.game.pointsSpentOnGame
                }
            };
            localStorage.setItem('movieVerseData', JSON.stringify(dataToSave));
        },
        load() {
            const saved = JSON.parse(localStorage.getItem('movieVerseData')) || {};
            app.state.userPoints = saved.userPoints || 0;
            if (saved.game) {
                app.state.game.pointsSpentOnGame = saved.game.pointsSpentOnGame || 0;
                saved.game.generators?.forEach(sg => { const g = app.state.game.generators.find(gen => gen.id === sg.id); if (g) g.level = sg.level; });
                saved.game.achievements?.forEach(sa => { const a = app.state.game.achievements.find(ach => ach.id === sa.id); if (a) a.unlocked = sa.unlocked; });
            }
            return saved;
        }
    },

    admin: {
        login() {
            const user = document.getElementById('adminUser').value;
            const pass = document.getElementById('adminPass').value;
            if (user === app.config.ADMIN_USER && pass === app.config.ADMIN_PASS) {
                sessionStorage.setItem('isAdminLoggedIn', 'true');
                bootstrap.Modal.getInstance(document.getElementById('adminLoginModal')).hide();
                this.showPanel();
                app.ui.showToast('Admin login successful!', 'success');
            } else {
                app.ui.showToast('Invalid credentials!', 'error');
            }
        },
        logout() {
            sessionStorage.removeItem('isAdminLoggedIn');
            document.getElementById('admin-nav-tab').style.display = 'none';
            app.ui.showTab('search-view');
            app.ui.showToast('Logged out.');
        },
        showPanel() {
            document.getElementById('admin-nav-tab').style.display = 'block';
            app.ui.showTab('admin-panel');
            this.renderRequests();
        },
        renderRequests() {
            const requests = app.data.loadPayoutRequests();
            const listDiv = document.getElementById('payout-requests-list');
            if(!listDiv) return;
            if(requests.length === 0) { listDiv.innerHTML = '<p>No pending payout requests.</p>'; return; }
            let table = '<table class="table table-dark table-hover"><thead><tr><th>Date</th><th>Method</th><th>Details</th><th>Amount</th><th>Action</th></tr></thead><tbody>';
            requests.forEach((req, index) => {
                table += `<tr><td>${req.date}</td><td><span class="badge bg-info text-dark">${req.method}</span></td><td>${req.details}</td><td>$${req.amount} (${req.points} Pts)</td><td><button class="btn btn-sm btn-outline-danger" onclick="app.admin.deleteRequest(${index})"><i class="fas fa-trash"></i></button></td></tr>`;
            });
            table += '</tbody></table>';
            listDiv.innerHTML = table;
        },
        deleteRequest(index) {
            if(confirm('Delete this request? This cannot be undone.')) {
                let requests = app.data.loadPayoutRequests();
                requests.splice(index, 1);
                localStorage.setItem('payoutRequests', JSON.stringify(requests));
                this.renderRequests();
            }
        }
    }
};

app.init();
</script>
<script src='//libtl.com/sdk.js' data-zone='9563904' data-sdk='show_s' async></script>
</body>
</html>
