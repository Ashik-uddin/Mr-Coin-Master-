<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aviator – Mr. Coin Casino</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Chart.js for the multiplier graph -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: #0f0f0f;
      color: #e0e0e0;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .container {
      max-width: 500px;
      margin: auto;
    }
    .balance {
      font-size: 1.2rem;
      text-align: center;
      margin-bottom: 15px;
    }
    #graph-container {
      position: relative;
      height: 200px;
      margin-bottom: 10px;
    }
    .multiplier-display {
      font-size: 2.5rem;
      text-align: center;
      margin-bottom: 10px;
      color: #00ffc3;
      text-shadow: 0 0 8px #00ffc3;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .controls input[type=number] {
      width: 80px;
      text-align: center;
      background: #1a1a1a;
      border: 1px solid #333;
      color: #e0e0e0;
      border-radius: 4px;
      padding: 4px;
    }
    .controls button {
      background: #00ffc3;
      color: #0f0f0f;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      transition: transform .1s;
    }
    .controls button:active {
      transform: scale(0.95);
    }
    .history {
      background: #1a1a1a;
      padding: 10px;
      border-radius: 4px;
    }
    .history h6 {
      margin-top: 0;
    }
    .history .round {
      display: inline-block;
      background: #333;
      color: #00ffc3;
      padding: 4px 8px;
      margin: 2px;
      border-radius: 4px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="balance">
      Balance: <span id="coins">0</span> TK  
      &nbsp;|&nbsp;  
      Bet: <span id="betDisplay">0.5</span> TK  
      &nbsp;|&nbsp;  
      Win: <span id="payoutDisplay">0.00</span> TK
    </div>

    <div id="graph-container">
      <canvas id="multiplierChart"></canvas>
    </div>

    <div class="multiplier-display">
      <span id="currentMultiplier">1.00</span>x
    </div>

    <div class="controls">
      <button id="betDec">–</button>
      <input id="betInput" type="number" step="0.5" min="0.5" value="0.5"/>
      <button id="betInc">+</button>
      <button id="cashout" disabled>Cash Out</button>
      <button id="playBtn">Play</button>
    </div>

    <div class="history">
      <h6>Last Rounds:</h6>
      <div id="roundHistory"></div>
    </div>
  </div>

  <script>
    // --- State & Persistence ---
    let coins = parseFloat(localStorage.getItem('coins')) || 100;
    let bet = 0.5;
    let chart, runInterval, crashPoint;
    const historyEl = document.getElementById('roundHistory');

    // Update Balance & Bet Displays
    function updateDisplays() {
      document.getElementById('coins').innerText = coins.toFixed(2);
      document.getElementById('betDisplay').innerText = bet.toFixed(2);
      document.getElementById('payoutDisplay').innerText = (bet * parseFloat(document.getElementById('currentMultiplier').innerText)).toFixed(2);
      localStorage.setItem('coins', coins);
    }
    updateDisplays();

    // --- Chart.js Setup ---
    const ctx = document.getElementById('multiplierChart').getContext('2d');
    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Multiplier',
          data: [],
          borderColor: '#00ffc3',
          backgroundColor: 'rgba(0,255,195,0.2)',
          pointRadius: 0,
          tension: 0.3
        }]
      },
      options: {
        animation: false,
        scales: {
          x: { display: false },
          y: {
            min: 1,
            ticks: { color: '#e0e0e0' }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });

    // --- Bet Controls ---
    document.getElementById('betDec').onclick = () => {
      bet = Math.max(0.5, bet - 0.5);
      document.getElementById('betInput').value = bet;
      updateDisplays();
    };
    document.getElementById('betInc').onclick = () => {
      bet = bet + 0.5;
      document.getElementById('betInput').value = bet;
      updateDisplays();
    };
    document.getElementById('betInput').oninput = e => {
      bet = Math.max(0.5, parseFloat(e.target.value) || 0.5);
      updateDisplays();
    };

    // --- Play / Crash Logic ---
    document.getElementById('playBtn').onclick = startRound;
    document.getElementById('cashout').onclick = cashOut;

    function startRound() {
      if (bet > coins) return alert('Not enough balance!');
      coins -= bet;
      updateDisplays();

      // Prepare round
      chart.data.labels.length = 0;
      chart.data.datasets[0].data.length = 0;
      chart.update();
      document.getElementById('currentMultiplier').innerText = '1.00';
      document.getElementById('cashout').disabled = false;
      document.getElementById('playBtn').disabled = true;

      // Random crash between 1.2 and 12.0
      crashPoint = (Math.random() * 10 + 1.2).toFixed(2);

      let m = 1.00;
      const step = () => {
        m += m * 0.01; // exponential growth
        if (m.toFixed(2) >= crashPoint) {
          // CRASH!
          endRound(false);
        } else {
          // update
          document.getElementById('currentMultiplier').innerText = m.toFixed(2);
          chart.data.labels.push('');
          chart.data.datasets[0].data.push(m.toFixed(2));
          chart.update();
        }
      };
      runInterval = setInterval(step, 100);
    }

    function endRound(won) {
      clearInterval(runInterval);
      document.getElementById('cashout').disabled = true;
      document.getElementById('playBtn').disabled = false;

      const cm = parseFloat(document.getElementById('currentMultiplier').innerText);
      let result, reward = 0;
      if (won) {
        reward = (bet * cm).toFixed(2);
        coins += parseFloat(reward);
        result = `${reward} TK`;
      } else {
        result = 'CRASHED';
      }
      updateHistory(cm, result);
      updateDisplays();

      // Monetag rewarded ad on round end
      show_9563904('pop')
        .then(() => alert('Thanks for watching an ad!'))
        .catch(() => {/* ignore */});
    }

    function cashOut() {
      endRound(true);
    }

    // --- Round History ---
    function updateHistory(mult, res) {
      const div = document.createElement('div');
      div.className = 'round';
      div.innerText = `${mult}x → ${res}`;
      historyEl.prepend(div);
      if (historyEl.children.length > 8) {
        historyEl.removeChild(historyEl.lastChild);
      }
    }
  </script>
</body>
</html>
